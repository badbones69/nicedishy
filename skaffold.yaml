apiVersion: skaffold/v2beta2
kind: Config

profiles:
  - name: codespace
    activation:
      - env: USER=codespace
    build:
      local:
        concurrency: 0
        useBuildkit: true
        push: true

build:
  insecureRegistries:
    - localhost:5000
    - k3d-nicedishy-registry.localhost:5000


  artifacts:
    - image: nicedishy-frontend
      context: "./nicedishy"
      sync:
        manual:
          - src: "pages/**"
            dest: "./"
          - src: "styles/**"
            dest: "./"
      docker:
        dockerfile: ./Dockerfile.skaffold

    - image: nicedishy-api
      context: "./"
      docker:
        dockerfile: ./Dockerfile.api.skaffold

deploy:
  statusCheckDeadlineSeconds: 240
  kustomize:
    paths:
      - "./kustomize/overlays/dev"

portForward:
- resourceType: deployment
  resourceName: nicedishy-frontend
  port: 3000
  localPort: 3000
- resourceType: deployment
  resourceName: nicedishy-api
  port: 3000
  localPort: 30065
- resourceType: statefulset
  resourceName: grafana
  port: 3000
  localPort: 33333
