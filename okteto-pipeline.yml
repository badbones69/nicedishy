icon: https://github.com/okteto/polling/raw/master/icon.png
deploy:
  - envsubst < kustomize/overlays/dev/google-secret-tmpl.yaml > kustomize/overlays/dev/google-secret.yaml

  - okteto build -f ./nicedishy/Dockerfile.okteto -t okteto.dev/nicedishy-frontend:${OKTETO_GIT_COMMIT} nicedishy
  - okteto build -f ./Dockerfile.okteto -t okteto.dev/nicedishy-api:${OKTETO_GIT_COMMIT} .
  - okteto build -f ./migrations/Dockerfile.okteto -t okteto.dev/nicedishy-migrations:${OKTETO_GIT_COMMIT} migrations

  - cd kustomize/overlays/dev && kustomize edit set image nicedishy-frontend=okteto.dev/nicedishy-frontend:${OKTETO_GIT_COMMIT}
  - cd kustomize/overlays/dev && kustomize edit set image nicedishy-api=okteto.dev/nicedishy-api:${OKTETO_GIT_COMMIT}
  - cd kustomize/overlays/dev && kustomize edit set image nicedishy-migrations=okteto.dev/nicedishy-migrations:${OKTETO_GIT_COMMIT}

  - kubectl apply -k kustomize/overlays/dev
devs:
  - nicedishy/okteto.yml
  - okteto.yml
